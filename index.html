v<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
  <title>Bíblia online 3- Completa com todos os livros</title>
  <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="icon-192x192.png" />
  <link rel="apple-touch-icon" href="icon-192x192.png" />
  <meta name="theme-color" content="#4A148C" />
    <style>
        :root {
            --primary-color: #4A148C; /* Roxo Escuro */
            --secondary-color: #8E24AA; /* Roxo Médio */
            --accent-color: #FFEB3B; /* Amarelo Vibrante (para destaque) */
            --background-light: #F3E5F5; /* Lavanda Clara */
            --background-dark: #673AB7; /* Roxo Profundo para seções */
            --text-color-dark: #212121;
            --text-color-light: #FFFFFF;
            --error-color: #D32F2F; /* Vermelho Escuro */
            --success-color: #388E3C; /* Verde Escuro */
            --border-color: #CE93D8; /* Lilás Claro */
            --input-bg: #EDE7F6; /* Roxo Bem Claro */
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-color-dark);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary-color);
            color: var(--text-color-light);
            padding: 1.5em 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        main {
            flex-grow: 1; /* Permite que o main ocupe o espaço restante */
            max-width: 960px;
            margin: 25px auto;
            padding: 25px;
            background-color: var(--text-color-light);
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        section {
            margin-bottom: 40px;
            padding: 25px;
            background-color: var(--background-dark);
            border-radius: 10px;
            color: var(--text-color-light);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }

        section:last-child {
            margin-bottom: 0;
        }

        h2 {
            color: var(--accent-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 12px;
            margin-bottom: 25px;
            font-size: 2.2em;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 0; /* Managed by grid gap */
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--background-light);
            font-size: 1.1em;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.1em;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-color-dark);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        select:focus, input[type="text"]:focus, input[type="number"]:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(142, 36, 170, 0.2);
            outline: none;
        }

        button {
            background-color: var(--accent-color);
            color: var(--primary-color);
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%; /* Ocupa a largura total no grid/flex */
        }

        button:hover {
            background-color: #FFC107; /* Amarelo um pouco mais escuro */
            transform: translateY(-2px);
        }

        .result-container {
            margin-top: 25px;
            padding: 20px;
            background-color: var(--background-light);
            border-left: 6px solid var(--secondary-color);
            border-radius: 8px;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            color: var(--text-color-dark);
        }

        .result-container h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.6em;
            margin-bottom: 15px;
        }

        .verse-text {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--text-color-light);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        .result-item strong {
            color: var(--secondary-color);
        }

        .result-item mark {
            background-color: var(--accent-color);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .message {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }

        .error-message {
            background-color: #FFEBEE; /* Vermelho muito claro */
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }

        .loading-message {
            background-color: #E3F2FD; /* Azul muito claro */
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
        }

        .success-message {
            background-color: #E8F5E9; /* Verde muito claro */
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        /* Accessibility: Focus styles */
        .verse-text[tabindex="0"]:focus, .result-item[tabindex="0"]:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 3px;
            box-shadow: 0 0 0 5px rgba(255, 235, 59, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2em;
            }

            main {
                margin: 15px;
                padding: 15px;
            }

            section {
                padding: 20px;
            }

            h2 {
                font-size: 1.8em;
            }

            .form-grid {
                grid-template-columns: 1fr; /* Uma coluna em telas menores */
            }

            button {
                padding: 12px 20px;
                font-size: 1.1em;
            }

            .result-container {
                padding: 15px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Bíblia Online Nós 3</h1>
    </header>

    <main>
        <section id="busca-versiculo-exato">
            <h2>Buscar Versículo Exato (Online)</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="book-select">Livro:</label>
                    <select id="book-select">
                        </select>
                </div>
                <div class="form-group">
                    <label for="chapter-input">Capítulo:</label>
                    <input type="number" id="chapter-input" min="1" value="1">
                </div>
                <div class="form-group">
                    <label for="verse-input">Versículo:</label>
                    <input type="number" id="verse-input" min="1" value="1">
                </div>
                <div class="form-group" style="grid-column: span 1 / auto;"> <button id="search-verse-btn">Buscar Versículo</button>
                </div>
            </div>
            <div id="online-message" class="message"></div>
            <div id="online-result" class="result-container"></div>
        </section>

        <section id="busca-local-palavra">
            <h2>Buscar por Palavra ou Trecho (Híbrida/Local)</h2>
            <div class="form-group">
                <label for="local-search-input">Palavra ou Trecho:</label>
                <input type="text" id="local-search-input" placeholder="Ex: amor, fé, Jesus, 'vida eterna'">
            </div>
            <button id="search-local-btn">Buscar Palavra</button>
            <div id="local-message" class="message"></div>
            <div id="local-result" class="result-container"></div>
        </section>
    </main>

    <script>
        // --- Dados e Mapeamentos ---
        const bookMap = {
            "Gênesis": "gen", "Êxodo": "exo", "Levítico": "lev", "Números": "num", "Deuteronômio": "deu",
            "Josué": "jos", "Juízes": "jdg", "Rute": "rut", "1 Samuel": "1sa", "2 Samuel": "2sa",
            "1 Reis": "1ki", "2 Reis": "2ki", "1 Crônicas": "1ch", "2 Crônicas": "2ch", "Esdras": "ezr",
            "Neemias": "neh", "Ester": "est", "Jó": "job", "Salmos": "psa", "Provérbios": "pro",
            "Eclesiastes": "ecc", "Cantares": "sng", "Isaías": "isa", "Jeremias": "jer", "Lamentações": "lam",
            "Ezequiel": "ezk", "Daniel": "dan", "Oseias": "hos", "Joel": "jol", "Amós": "amo",
            "Obadias": "oba", "Jonas": "jon", "Miqueias": "mic", "Naum": "nam", "Habacuque": "hab",
            "Sofonias": "zep", "Ageu": "hag", "Zacarias": "zec", "Malaquias": "mal",
            "Mateus": "mat", "Marcos": "mrk", "Lucas": "luk", "João": "jhn", "Atos": "act",
            "Romanos": "rom", "1 Coríntios": "1co", "2 Coríntios": "2co", "Gálatas": "gal", "Efésios": "eph",
            "Filipenses": "php", "Colossenses": "col", "1 Tessalonicenses": "1th", "2 Tessalonicenses": "2th",
            "1 Timóteo": "1ti", "2 Timóteo": "2ti", "Tito": "tit", "Filemom": "phm", "Hebreus": "heb",
            "Tiago": "jas", "1 Pedro": "1pe", "2 Pedro": "2pe", "1 João": "1jn", "2 João": "2jn",
            "3 João": "3jn", "Judas": "jud", "Apocalipse": "rev"
        };

        let localBibleData = null; // Será preenchido com a Bíblia completa

        // --- Elementos DOM ---
        const bookSelect = document.getElementById('book-select');
        const chapterInput = document.getElementById('chapter-input');
        const verseInput = document.getElementById('verse-input');
        const searchVerseBtn = document.getElementById('search-verse-btn');
        const onlineResultDiv = document.getElementById('online-result');
        const onlineMessageDiv = document.getElementById('online-message');

        const localSearchInput = document.getElementById('local-search-input');
        const searchLocalBtn = document.getElementById('search-local-btn');
        const localResultDiv = document.getElementById('local-result');
        const localMessageDiv = document.getElementById('local-message');

        // --- Funções Auxiliares ---

        // Preencher o select de livros
        function populateBooks() {
            for (const bookName in bookMap) {
                const option = document.createElement('option');
                option.value = bookMap[bookName];
                option.textContent = bookName;
                bookSelect.appendChild(option);
            }
        }
        populateBooks();

        // Limpar mensagens e resultados
        function clearResultsAndMessages(resultDiv, messageDiv) {
            resultDiv.innerHTML = '';
            messageDiv.textContent = '';
            messageDiv.className = 'message'; // Reseta as classes
        }

        // Função para destacar o termo de busca nos resultados locais
        function highlightText(text, searchTerm) {
            // Escapar caracteres especiais para a regex
            const escapedSearchTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedSearchTerm})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        // --- Lógica de Carregamento da Bíblia Local ---

        async function loadLocalBible() {
            localMessageDiv.classList.add('loading-message');
            localMessageDiv.textContent = 'Carregando Bíblia completa para busca local (aproximadamente 3-5MB)...';
            searchLocalBtn.disabled = true; // Desabilita o botão enquanto carrega

            try {
                // IMPORTANT: Para que esta linha funcione localmente (abrindo index.html diretamente no navegador),
                // você precisará de um servidor web simples (ex: `live-server` do npm, `python -m http.server`).
                // Caso contrário, o navegador bloqueará a requisição por segurança (CORS).
                // Coloque o arquivo 'bible.json' na mesma pasta do 'index.html'.
                const response = await fetch('bible.json');
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status} ${response.statusText}`);
                }
                localBibleData = await response.json();
                console.log('Bíblia local carregada com sucesso!', localBibleData.length, 'versículos.');
                localMessageDiv.classList.remove('loading-message');
                localMessageDiv.classList.add('success-message');
                localMessageDiv.textContent = 'Bíblia completa carregada! Você já pode buscar por palavras.';
                searchLocalBtn.disabled = false; // Habilita o botão após o carregamento
            } catch (error) {
                console.error('Erro ao carregar a Bíblia local:', error);
                localMessageDiv.classList.remove('loading-message');
                localMessageDiv.classList.add('error-message');
                localMessageDiv.textContent = 'Erro ao carregar a Bíblia local para busca offline. Verifique sua conexão e se o arquivo bible.json está disponível. A busca por palavra não funcionará.';
                searchLocalBtn.disabled = true; // Mantém desabilitado em caso de erro
            }
        }

        // --- Event Listeners ---

        // Buscar versículo exato na API
        searchVerseBtn.addEventListener('click', async () => {
            clearResultsAndMessages(onlineResultDiv, onlineMessageDiv);
            onlineMessageDiv.classList.add('loading-message');
            onlineMessageDiv.textContent = 'Buscando versículo online...';

            const selectedBookAbbr = bookSelect.value;
            const chapter = chapterInput.value;
            const verse = verseInput.value;
            const bookName = bookSelect.options[bookSelect.selectedIndex].textContent;

            if (!selectedBookAbbr || !chapter || !verse) {
                onlineMessageDiv.classList.add('error-message');
                onlineMessageDiv.textContent = 'Por favor, selecione um livro e informe o capítulo e versículo.';
                return;
            }

            // Usando a tradução Almeida (ACF) - você pode mudar para 'kjv', 'nkjv', 'web', etc. se a API suportar
            const apiUrl = `https://bible-api.com/${selectedBookAbbr}${chapter}:${verse}?translation=almeida`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                onlineMessageDiv.className = 'message'; // Reseta classe

                if (data.error || !data.verses || data.verses.length === 0) {
                    onlineMessageDiv.classList.add('error-message');
                    onlineMessageDiv.textContent = `Erro: ${data.error || 'Versículo não encontrado. Verifique o livro, capítulo e versículo digitados.'}`;
                } else {
                    const verseData = data.verses[0];
                    const verseHtml = `
                        <h3>${verseData.book_name} ${verseData.chapter}:${verseData.verse}</h3>
                        <p class="verse-text" tabindex="0">${verseData.text}</p>
                    `;
                    onlineResultDiv.innerHTML = verseHtml;
                }
            } catch (error) {
                onlineMessageDiv.classList.add('error-message');
                onlineMessageDiv.textContent = 'Erro ao buscar o versículo online. Verifique sua conexão ou tente novamente.';
                console.error('Erro na busca online:', error);
            }
        });

        // Buscar por palavra ou trecho na base local
        searchLocalBtn.addEventListener('click', () => {
            clearResultsAndMessages(localResultDiv, localMessageDiv);
            const searchTerm = localSearchInput.value.trim().toLowerCase();

            if (!localBibleData) {
                localMessageDiv.classList.add('error-message');
                localMessageDiv.textContent = 'A Bíblia ainda não foi carregada. Por favor, aguarde ou recarregue a página.';
                return;
            }

            if (!searchTerm) {
                localMessageDiv.classList.add('error-message');
                localMessageDiv.textContent = 'Por favor, digite uma palavra ou trecho para buscar.';
                return;
            }

            // Filtra os resultados
            const results = localBibleData.filter(item =>
                item.text.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                localMessageDiv.textContent = 'Nenhum resultado encontrado para o termo pesquisado na Bíblia local.';
            } else {
                let resultsHtml = `<h3>Resultados da Busca Local para "${searchTerm}":</h3>`;
                // Limita o número de resultados para evitar sobrecarga da interface
                const displayLimit = 50;
                results.slice(0, displayLimit).forEach(item => {
                    resultsHtml += `
                        <div class="result-item" tabindex="0">
                            <strong>${item.book} ${item.chapter}:${item.verse}</strong>: ${highlightText(item.text, searchTerm)}
                        </div>
                    `;
                });
                if (results.length > displayLimit) {
                    resultsHtml += `<p class="message" style="background-color: #FFF3E0; color: #E65100;">Mostrando os primeiros ${displayLimit} resultados de ${results.length} encontrados.</p>`;
                }
                localResultDiv.innerHTML = resultsHtml;
            }
        });

        // Chamar a função para carregar a Bíblia local assim que o script é executado
        loadLocalBible();
    </script>
    <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('✅ Service Worker registrado', reg))
          .catch(err => console.error('❌ Erro ao registrar o SW:', err));
      });
    }
</script>
</body>
</html>
